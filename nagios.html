<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Alerting with Nagios - OpenTSDB - A Distributed, Scalable Monitoring System</title>
    
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/custom.css" rel="stylesheet">

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-18339382-1']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body>
     <div class="container">
       <h1><a href="http://www.opentsdb.net/">OpenTSDB</a></h1>
       
     <div class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <ul class="nav navbar-nav">
              <li class="active"><a href="index.html">Home</a></li>
              <li><a href="overview.html">Overview</a></li>
              <li><a href="https://github.com/OpenTSDB/opentsdb">Download</a></li>
              <li><a href="https://github.com/OpenTSDB/opentsdb">Source</a></li>
              <li><a href="docs/build/html/index.html">Documentation</a></li>
              <li><a href="faq.html">FAQ</a></li>
            </ul>
          </div>
        </div>
      </div><section id="nagios">
<h2>Alerting via Nagios</h2>

OpenTSDB is great, but it's not (yet) a full monitoring platform.
Now that you have a bunch of metrics in OpenTSDB, you want to start sending
alerts when thresholds are getting too high.  It's easy!

<p>
In the <code>tools</code> directory is a Python script
<code>check_tsd</code>.  This script queries OpenTSDB and returns
Nagios compatible output that gives you OK/WARNING/CRITICAL state.

<p>
Drop it in your Nagios path and set up a command like this:

<div class="code">define command{
        command_name check_tsd
        command_line $USER1$/check_tsd -H $HOSTADDRESS$ $ARG1$
}
</div>

<p>
Then define a host in nagios for your TSD server(s).  You can give it a
check_command that is guaranteed to always return something if the backend
is healthy.
<div class="code">define host{
        host_name               tsd
        address                 tsd
        check_command           check_tsd!-d 60 -m rate:tsd.rpc.received -t type=put -x lt -c 1
        [...]
}
</div>

Then define some service checks for the things you want to monitor.

<div class="code">define service{
        host_name                       tsd
        service_description             Apache too many internal errors
        check_command                   check_tsd!-d 300 -m rate:apache.stats.hits -t status=500 -w 1 -c 2
        [...]
}
</div>

<h2>check_tsd usage</h2>

<div class="code">Simple TSDB data extractor for Nagios.

Options:
  -h, --help            show this help message and exit
  -H HOST, --host=HOST  Hostname to use to connect to the TSD.
  -p PORT, --port=PORT  Port to connect to the TSD instance on.
  -m METRIC, --metric=METRIC
                        Metric to query.
  -t TAG, --tag=TAG     Tags to filter the metric on.
  -d SECONDS, --duration=SECONDS
                        How far back to look for data.
  -D METHOD, --downsample=METHOD
                        Downsample the data over the duration via avg, min,
                        sum, or max.
  -a METHOD, --aggregator=METHOD
                        Aggregation method: avg, min, sum (default), max.
  -x METHOD, --method=METHOD
                        Comparison method for -w/-c: gt, ge, lt, le, eq, ne.
  -w THRESHOLD, --warning=THRESHOLD
                        Threshold for warning.  Uses the comparison method.
  -c THRESHOLD, --critical=THRESHOLD
                        Threshold for critical.  Uses the comparison method.
  -v, --verbose         Be more verbose.
  -T SECONDS, --timeout=SECONDS
                        How long to wait for the response from TSD.
  -E, --no-result-ok    Return OK when TSD query returns no result.
  -I SECONDS, --ignore-recent=SECONDS
                        Ignore data points that are that are that recent.
</div>


</section>
      <hr>
      <div class="footer">
        <p><a href="https://groups.google.com/forum/#!forum/opentsdb"><i class="glyphicon glyphicon-envelope"></i> Mailing List</a>  | <i class="glyphicon glyphicon-user"></i> IRC: Freenode #opentsdb  |  &copy; 2010 - 2014 The OpenTSDB Authors</p>
      </div>
    </div> <!-- /container -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>
